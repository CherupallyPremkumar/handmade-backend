<?xml version="1.0" encoding="UTF-8"?>
<!--
Standard E-commerce Dispute State Machine
Purpose: Manage disputes raised by buyers/sellers.
Flow: DISPUTE_FLOW
-->
<states>

    <event-information eventId='assign' eventName='Assign owner' meta-acls="support.ops"
                       meta-bodyType=""/>
    <event-information eventId='review' eventName='Review' meta-acls="support.ops"
                       meta-bodyType=""/>
    <event-information eventId='resolve' eventName='Resolve' meta-acls="support.ops"
                       meta-bodyType="com.handmade.ecommerce.cart.dto.AbandonCartPayload"/>
    <event-information eventId='escalate' eventName='Escalate' meta-acls="support.ops"
                       meta-bodyType="com.handmade.ecommerce.cart.dto.RecoverCartPayload"/>
    <event-information eventId='close' eventName='Close' meta-acls="support.ops"
                       meta-bodyType="com.handmade.ecommerce.cart.dto.MergeCartPayload"/>

    <flow id="DISPUTE_FLOW" default="true">
        <manual-state id="OPEN" initialState="true">
            <on eventId="assign"  newStateId="ASSIGNED"      componentName="com.handmade.ecommerce.dispute.service.cmds.AssignDisputeAction"/>
            <on eventId="resolve" newStateId="RESOLVED"      componentName="com.handmade.ecommerce.dispute.service.cmds.ResolveDisputeAction"/>
            <on eventId="close"   newStateId="CLOSED_NO_ACTION" componentName="com.handmade.ecommerce.dispute.service.cmds.CloseDisputeAction"/>
        </manual-state>

        <manual-state id="ASSIGNED">
            <on eventId="review"   newStateId="UNDER_REVIEW" componentName="com.handmade.ecommerce.dispute.service.cmds.ReviewDisputeAction"/>
            <on eventId="resolve"  newStateId="RESOLVED"      componentName="com.handmade.ecommerce.dispute.service.cmds.ResolveDisputeAction"/>
            <on eventId="escalate" newStateId="ESCALATED"     componentName="com.handmade.ecommerce.dispute.service.cmds.EscalateDisputeAction"/>
        </manual-state>

        <manual-state id="UNDER_REVIEW">
            <on eventId="resolve"  newStateId="RESOLVED"  componentName="com.handmade.ecommerce.dispute.service.cmds.ResolveDisputeAction"/>
            <on eventId="escalate" newStateId="ESCALATED" componentName="com.handmade.ecommerce.dispute.service.cmds.EscalateDisputeAction"/>
        </manual-state>

        <manual-state id="ESCALATED">
            <on eventId="review"  newStateId="UNDER_REVIEW" componentName="com.handmade.ecommerce.dispute.service.cmds.ReviewDisputeAction"/>
            <on eventId="resolve" newStateId="RESOLVED"      componentName="com.handmade.ecommerce.dispute.service.cmds.ResolveDisputeAction"/>
        </manual-state>

        <manual-state id="RESOLVED"        meta-endState="true"/>
        <manual-state id="CLOSED_NO_ACTION" meta-endState="true"/>
    </flow>
</states>
