<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="seller-orders">

    <!-- Search My Orders -->
    <select id="search-my-orders" resultType="java.util.HashMap">
        SELECT 
            o.id as "order_id",
            cp.firstName as "customer_name",
            o.status as "order_status",
            o.total_amount as "total_revenue",
            o.created_at as "order_date",
            s.status as "shipment_status",
            s.tracking_number as "tracking_id"
        FROM hm_order o
        JOIN hm_order_line ol ON ol.order_id = o.id
        JOIN hm_offer off ON off.id = ol.offer_id
        LEFT JOIN hm_customer_profile cp ON cp.id = o.customer_id
        LEFT JOIN hm_shipment s ON s.order_id = o.id
        WHERE off.seller_id = #{seller_id}
        <if test="order_id != null">
            AND o.id = #{order_id}
        </if>
        <if test="status != null">
            AND o.status = #{status}
        </if>
        GROUP BY o.id, cp.firstName, o.status, o.total_amount, o.created_at, s.status, s.tracking_number
        ${orderby}
        ${pagination}
    </select>

    <select id="search-my-orders-count" resultType="int">
        SELECT COUNT(DISTINCT o.id)
        FROM hm_order o
        JOIN hm_order_line ol ON ol.order_id = o.id
        JOIN hm_offer off ON off.id = ol.offer_id
        WHERE off.seller_id = #{seller_id}
        <if test="order_id != null">
            AND o.id = #{order_id}
        </if>
        <if test="status != null">
            AND o.status = #{status}
        </if>
    </select>

</mapper>
