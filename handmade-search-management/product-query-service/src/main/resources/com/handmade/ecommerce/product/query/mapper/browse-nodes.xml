<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="browse-nodes">
    
    <!-- Get child nodes for a parent (or root if parent_id is null) -->
    <select id="browse-nodes" resultType="java.util.HashMap">
        SELECT 
            id as "id",
            name as "name",
            slug as "slug",
            parent_id as "parent_id",
            level as "level",
            display_order as "display_order",
            image_url as "image_url",
            icon as "icon",
            product_count as "product_count"
        FROM hm_browse_node
        WHERE active = true
          AND tenant = #{tenantId}
        <choose>
            <when test="parent_id != null">
                AND parent_id = #{parent_id}
            </when>
            <otherwise>
                AND parent_id IS NULL
            </otherwise>
        </choose>
        ORDER BY display_order ASC
    </select>

</mapper>
