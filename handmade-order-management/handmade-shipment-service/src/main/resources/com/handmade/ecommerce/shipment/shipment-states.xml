<?xml version="1.0" encoding="UTF-8"?>
<states>
    <event-information eventId="book" meta-bodyType="com.handmade.ecommerce.order.dto.BookShipmentPayload"/>
    <event-information eventId="cancel" meta-bodyType="com.handmade.ecommerce.order.dto.CancelShipmentPayload"/>
    <event-information eventId="deliver" meta-bodyType="com.handmade.ecommerce.order.dto.DeliverShipmentPayload"/>
    <event-information eventId="exception" meta-bodyType="com.handmade.ecommerce.order.dto.ExceptionShipmentPayload"/>
    <event-information eventId="outForDelivery" meta-bodyType="com.handmade.ecommerce.order.dto.OutForDeliveryShipmentPayload"/>
    <event-information eventId="pickup" meta-bodyType="com.handmade.ecommerce.order.dto.PickupShipmentPayload"/>
    <event-information eventId="retry" meta-bodyType="com.handmade.ecommerce.order.dto.RetryShipmentPayload"/>
    <event-information eventId="returnToSender" meta-bodyType="com.handmade.ecommerce.order.dto.ReturnToSenderShipmentPayload"/>
    <event-information eventId="transit" meta-bodyType="com.handmade.ecommerce.order.dto.TransitShipmentPayload"/>

    <flow id="shipmentFlow" default="true">
        <manual-state id="CREATED" initialState="true">
            <on eventId="book" newStateId="BOOKED" componentName="com.handmade.ecommerce.shipment.service.cmds.BookShipmentAction"/>
        </manual-state>

        <manual-state id="BOOKED">
            <on eventId="pickup" newStateId="PICKED_UP" componentName="com.handmade.ecommerce.shipment.service.cmds.PickupShipmentAction"/>
            <on eventId="cancel" newStateId="CANCELLED" componentName="com.handmade.ecommerce.shipment.service.cmds.CancelShipmentAction"/>
        </manual-state>

        <manual-state id="PICKED_UP">
            <on eventId="transit" newStateId="IN_TRANSIT" componentName="com.handmade.ecommerce.shipment.service.cmds.TransitShipmentAction"/>
        </manual-state>

        <manual-state id="IN_TRANSIT">
            <on eventId="outForDelivery" newStateId="OUT_FOR_DELIVERY" componentName="com.handmade.ecommerce.shipment.service.cmds.OutForDeliveryShipmentAction"/>
            <on eventId="exception" newStateId="EXCEPTION" componentName="com.handmade.ecommerce.shipment.service.cmds.ExceptionShipmentAction"/>
        </manual-state>

        <manual-state id="OUT_FOR_DELIVERY">
            <on eventId="deliver" newStateId="DELIVERED" componentName="com.handmade.ecommerce.shipment.service.cmds.DeliverShipmentAction"/>
            <on eventId="exception" newStateId="EXCEPTION" componentName="com.handmade.ecommerce.shipment.service.cmds.ExceptionShipmentAction"/>
        </manual-state>

        <manual-state id="EXCEPTION">
            <on eventId="retry" newStateId="IN_TRANSIT" componentName="com.handmade.ecommerce.shipment.service.cmds.RetryShipmentAction"/>
            <on eventId="returnToSender" newStateId="RETURNED" componentName="com.handmade.ecommerce.shipment.service.cmds.ReturnToSenderShipmentAction"/>
        </manual-state>

        <manual-state id="DELIVERED" meta-endState="true"/>
        <manual-state id="RETURNED" meta-endState="true"/>
        <manual-state id="CANCELLED" meta-endState="true"/>
    </flow>
</states>
