<?xml version="1.0" encoding="UTF-8"?>
<!-- An example states xml file that demonstrates the following features:
 1. The progression of Seller from OPENED to CLOSED  and ARCHIVED.
 2. How to define and use a custom DSL to define the workflow.
 3. How to use the activity framework to define mandatory and optional activities (along with a custom
 DSL that allows us to define these activities)
 4. How to define an automatic "activity-checker" state that allows us to check if all the mandatory
 activities are completed before we proceed to the next status in the workflow.
     This also demonstrates how to attach security permissions (not roles) to a state event so that
     these perms would be checked before the action is allowed.
-->
<states>
    <enablement-strategy componentName="sellerConfigBasedEnablementStrategy"/>
	<default-transition-action componentName="sellerBaseTransitionAction"/>
    <add-transition-tag tag="mandatory-activity" meta-activity="MANDATORY"
                        meta-acls="test.premium" eventIdTag="id"/>
    <add-transition-tag tag="optional-activity" meta-activity="OPTIONAL"
                        meta-acls="test.premium" eventIdTag="id"/>
    <add-transition-tag tag="mandatory-post-closure-activity" meta-activity="MANDATORY"
                        meta-acls="test.premium" eventIdTag="id"
                        newStateId="AreClosedActivitiesComplete"/>
    <add-state-tag tag="post-closure-activities-completion-check"
                   componentName="activitiesCompletionCheck"
                   id="AreClosedActivitiesComplete"
                   whichStateId="CLOSED" />
    <add-transition-tag tag="on-completion" newStateIdTag="goto" eventId="yes"/>
    <add-transition-tag tag="if-not-complete" newStateIdTag="stay-in" eventId="no"/>
    <add-state-tag tag="status" manualState="true"/>
    <add-transition-tag tag="on-action" eventIdTag="id" newStateIdTag="move-to"
                    meta-acls="test.premium"/>

    <flow id="SellerFlow" default="true">
        <entry-action componentName="sellerEntryAction"/>
        <exit-action componentName="sellerExitAction"/>
        <security-strategy componentName="stmSecurityStrategy"/>

        <!-- Initial seller creation state -->
        <status id="DRAFT" initialState="true">
            <on-action id="addTax" componentName="addSellerTaxService" move-to="CHECK_SELLER"/>
            <on-action id="addPayment" componentName="AddSellerPaymentService" move-to="CHECK_SELLER"/>
            <on-action id="approve"  componentName="ApprovalSellerService" move-to="PENDING_APPROVAL"/>
        </status>

        <auto-state id="CHECK_SELLER" componentName="sellerAutoCheckService">
            <on eventId="filled" newStateId="PENDING_APPROVAL"/>
            <on eventId="notFilled" newStateId="DRAFT"/>
        </auto-state>

        <!-- Waiting for admin review -->
        <status id="PENDING_APPROVAL">
            <mandatory-activity id="verifyTaxInformation"/>
            <mandatory-activity id="verifyPaymentInformation"/>
            <!-- Admin actions -->
            <on-action id="approve"  componentName="sellerApprovalService" move-to="ACTIVE"/>
            <on-action id="reject"  componentName="sellerRejectionService" move-to="REJECTED"/>
        </status>

        <!-- Seller is fully approved -->
        <status id="ACTIVE">
            <on-action id="suspend"  componentName="sellerSuspendService" move-to="SUSPENDED"/>
        </status>

        <!-- Seller was rejected, can fix and resubmit -->
        <status id="REJECTED">
            <on-action id="resubmit" componentName="sellerResubmitService" move-to="PENDING_APPROVAL"/>
        </status>

        <!-- Seller temporarily disabled -->
        <status id="SUSPENDED">
            <on-action id="activate"  componentName="sellerActivateService" move-to="ACTIVE"/>
        </status>
    </flow>
	
</states>
