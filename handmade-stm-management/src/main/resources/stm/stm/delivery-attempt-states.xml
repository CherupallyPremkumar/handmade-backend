<?xml version="1.0" encoding="UTF-8"?>
<!--
Standard E-commerce DeliveryAttempt State Machine
Purpose: Track each last-mile delivery attempt.
Flow: DELIVERY_ATTEMPT_FLOW
-->
<states>
    <event-information eventId='startAttempt'   eventName='Start attempt'   meta-acls="user.normal,user.admin"/>
    <event-information eventId='markDelivered'  eventName='Mark delivered'  meta-acls="user.normal,user.admin"/>
    <event-information eventId='markFailed'     eventName='Mark failed'     meta-acls="user.normal,user.admin"/>
    <event-information eventId='reschedule'      eventName='Reschedule'      meta-acls="user.normal,user.admin"/>

    <flow id="DELIVERY_ATTEMPT_FLOW" default="true">
        <manual-state id="SCHEDULED" initialState="true">
            <on eventId="startAttempt" newStateId="IN_PROGRESS" componentName="deliveryStartAction"/>
        </manual-state>

        <manual-state id="IN_PROGRESS">
            <on eventId="markDelivered" newStateId="DELIVERED" componentName="deliverySuccessAction"/>
            <on eventId="markFailed"    newStateId="FAILED"    componentName="deliveryFailAction"/>
        </manual-state>

        <manual-state id="FAILED">
            <on eventId="reschedule" newStateId="SCHEDULED" componentName="deliveryRescheduleAction"/>
        </manual-state>

        <manual-state id="DELIVERED"  meta-endState="true"/>
    </flow>
</states>
