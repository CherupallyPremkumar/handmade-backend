databaseChangeLog:
  - changeSet:
      id: 1
      author: analytics-qa
      changes:
        # Metric Definitions
        - insert:
            tableName: hm_analytics_metric_def
            columns:
              - column: {name: id, value: "met-001"}
              - column: {name: metric_code, value: "PAGE_VIEW"}
              - column: {name: name, value: "Page Views"}
              - column: {name: aggregation_type, value: "COUNT"}
              - column: {name: value_type, value: "INT"}
              - column: {name: tenant, value: "default"}
        - insert:
            tableName: hm_analytics_metric_def
            columns:
              - column: {name: id, value: "met-002"}
              - column: {name: metric_code, value: "REVENUE"}
              - column: {name: name, value: "Total Revenue"}
              - column: {name: aggregation_type, value: "SUM"}
              - column: {name: value_type, value: "DECIMAL"}
              - column: {name: tenant, value: "default"}

        # Sessions
        - insert:
            tableName: hm_analytics_session
            columns:
              - column: {name: id, value: "sess-001"}
              - column: {name: user_id, value: "usr-100"}
              - column: {name: session_token, value: "tok-abc-123"}
              - column: {name: start_time, valueDate: "2025-01-08T08:00:00"}
              - column: {name: expires_at, valueDate: "2025-01-08T12:00:00"}
              - column: {name: status, value: "ACTIVE"}
              - column: {name: tenant, value: "default"}

        # Events
        - insert:
            tableName: hm_analytics_event
            columns:
              - column: {name: id, value: "evt-001"}
              - column: {name: event_type, value: "PAGE_VIEW"}
              - column: {name: session_id, value: "sess-001"}
              - column: {name: user_id, value: "usr-100"}
              - column: {name: event_timestamp, valueDate: "2025-01-08T08:05:00"}
              - column: {name: payload_json, value: '{"page": "/home", "referrer": "google"}'}
              - column: {name: tenant, value: "default"}

        # Metric Values (Precomputed)
        - insert:
            tableName: hm_analytics_metric_value
            columns:
              - column: {name: id, value: "val-001"}
              - column: {name: metric_def_id, value: "met-001"} # Page View
              - column: {name: dimension_key, value: "page:/home"}
              - column: {name: time_bucket, valueDate: "2025-01-08T08:00:00"}
              - column: {name: bucket_type, value: "HOUR"}
              - column: {name: metric_value, valueNumeric: 150}
              - column: {name: sample_count, valueNumeric: 150}
              - column: {name: tenant, value: "default"}
