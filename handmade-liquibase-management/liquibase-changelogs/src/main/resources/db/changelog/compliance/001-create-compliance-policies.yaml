databaseChangeLog:
  - changeSet:
      id: 1
      author: compliance-policy
      comment: Create compliance_policies table
      changes:
        - createTable:
            tableName: compliance_policies
            columns:
              # Base JPA Entity fields
              - column: {name: id, type: VARCHAR(36), constraints: {primaryKey: true, nullable: false}}
              - column: {name: created_time, type: TIMESTAMP}
              - column: {name: last_modified_time, type: TIMESTAMP}
              - column: {name: last_modified_by, type: VARCHAR(255)}
              - column: {name: created_by_user, type: VARCHAR(255)}
              - column: {name: version_num, type: BIGINT}
              - column: {name: tenant, type: VARCHAR(255)}
              
              # State Machine fields
              - column: {name: state_entry_time, type: TIMESTAMP}
              - column: {name: sla_yellow_date, type: TIMESTAMP}
              - column: {name: sla_red_date, type: TIMESTAMP}
              - column: {name: sla_tending_late, type: INT, defaultValueNumeric: 0}
              - column: {name: sla_late, type: INT, defaultValueNumeric: 0}
              - column: {name: flow_id, type: VARCHAR(50)}
              - column: {name: state_id, type: VARCHAR(50)}
              
              # Policy Identity
              - column: {name: version, type: VARCHAR(50), constraints: {nullable: false, unique: true}}
              - column: {name: country_code, type: VARCHAR(2), constraints: {nullable: false}}
              - column: {name: seller_type, type: VARCHAR(50), constraints: {nullable: false}}
              
              # Effective Dates
              - column: {name: effective_from, type: DATE, constraints: {nullable: false}}
              - column: {name: effective_to, type: DATE}
              - column: {name: deprecated_date, type: DATE}
              
              # Compliance Configuration
              - column: {name: minimum_compliance_score, type: INT, constraints: {nullable: false}}
              - column: {name: requires_annual_review, type: BOOLEAN, constraints: {nullable: false}}
              - column: {name: requires_aml_check, type: BOOLEAN, constraints: {nullable: false}}
              - column: {name: requires_data_protection, type: BOOLEAN, constraints: {nullable: false}}
              
              # Audit Fields
              - column: {name: created_by, type: VARCHAR(255), constraints: {nullable: false}}
              - column: {name: created_at, type: TIMESTAMP, constraints: {nullable: false}}
              - column: {name: approved_by, type: VARCHAR(255)}
              - column: {name: approved_at, type: TIMESTAMP}
              - column: {name: description, type: TEXT}
              - column: {name: regulatory_basis, type: TEXT}
        
        - addUniqueConstraint:
            tableName: compliance_policies
            columnNames: country_code, seller_type, version
            constraintName: uk_compliance_policy_version
        
        - createIndex:
            indexName: idx_active_compliance_policies
            tableName: compliance_policies
            columns:
              - column: {name: country_code}
              - column: {name: seller_type}
              - column: {name: state_id}
              - column: {name: effective_from}
