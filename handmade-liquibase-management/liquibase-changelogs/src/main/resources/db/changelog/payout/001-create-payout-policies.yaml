databaseChangeLog:
  - changeSet:
      id: 1
      author: payout-policy
      comment: Create payout_policies table
      changes:
        - createTable:
            tableName: payout_policies
            columns:
              # Base JPA Entity fields
              - column: {name: id, type: VARCHAR(36), constraints: {primaryKey: true, nullable: false}}
              - column: {name: created_time, type: TIMESTAMP}
              - column: {name: last_modified_time, type: TIMESTAMP}
              - column: {name: last_modified_by, type: VARCHAR(255)}
              - column: {name: created_by, type: VARCHAR(255)}
              - column: {name: version, type: BIGINT}
              - column: {name: tenant, type: VARCHAR(255)}
              
              # State Machine fields
              - column: {name: state_entry_time, type: TIMESTAMP}
              - column: {name: sla_yellow_date, type: TIMESTAMP}
              - column: {name: sla_red_date, type: TIMESTAMP}
              - column: {name: sla_tending_late, type: INT, defaultValueNumeric: 0}
              - column: {name: sla_late, type: INT, defaultValueNumeric: 0}
              - column: {name: flow_id, type: VARCHAR(50)}
              - column: {name: state_id, type: VARCHAR(50)}
              
              # Policy Identity
              - column: {name: policy_version, type: VARCHAR(50), constraints: {nullable: false, unique: true}}
              - column: {name: country_code, type: VARCHAR(2), constraints: {nullable: false}}
              - column: {name: seller_type, type: VARCHAR(50), constraints: {nullable: false}}
              
              # Effective Dates
              - column: {name: effective_from, type: DATE, constraints: {nullable: false}}
              - column: {name: effective_to, type: DATE}
              - column: {name: deprecated_date, type: DATE}
              
              # Payout Configuration
              - column:
                  name: default_frequency
                  type: VARCHAR(20)
                  constraints:
                    nullable: false
              - column:
                  name: minimum_threshold
                  type: DECIMAL(19, 4)
                  constraints:
                    nullable: false
              - column:
                  name: currency
                  type: VARCHAR(3)
                  constraints:
                    nullable: false
              - column:
                  name: hold_period_days
                  type: INT
                  constraints:
                    nullable: false
        
        - addUniqueConstraint:
            tableName: payout_policies
            columnNames: country_code, seller_type, policy_version
            constraintName: uk_payout_policy_version
        
        - createIndex:
            indexName: idx_active_payout_policies
            tableName: payout_policies
            columns:
              - column: {name: country_code}
              - column: {name: seller_type}
              - column: {name: state_id}
              - column: {name: effective_from}
