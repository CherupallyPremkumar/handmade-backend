<?xml version="1.0" encoding="UTF-8"?>
<flows>
    <flow id="seller-onboarding" defaultFlow="true">
        <seller-onboarding-chain>
            <seller-validation-parallel>
                <basic-fields-validator/>
                <validate-email/>
                <tax-id-validator-router expression="country">
                    <gstin-validator route="IN"/>
                    <ein-validator route="US"/>
                </tax-id-validator-router>
                <validate-bank-account-router expression="country">
                        <in-bank-account-validator route="IN" />
                        <us-bank-account-validator route="US"/>
                </validate-bank-account-router>
            </seller-validation-parallel>
            <verification-parallel-chain>
                <tax-id-verifier expression="country">
                    <verify-gstin-service route="IN" />
                    <verify-ein-service route="US" />
                </tax-id-verifier>
                <pan-verifier expression="country">
                    <verify-pan-service route="IN" />
                    <verify-ssn-service route="US"/>
                </pan-verifier>
                <bank-account-verifier expression="country">
                    <verify-indian-bank-service route="IN" />
                    <verify-us-bank-service route="US"/>
                </bank-account-verifier>
            </verification-parallel-chain>
            <create-seller-service/>
            <verify-document-upload-service/>
            <seller-parallel-chain>
                <send-welcome-email-service/>
                <trigger-document-verification-flow/>
            </seller-parallel-chain>
            <global-error-handler>
                <log-error-service/>
                <notify-admin-service/>
            </global-error-handler>
        </seller-onboarding-chain>
    </flow>

    <flow id="document-verification-flow">
        <seller-chain>
            <extract-document-data-service/>
            <api-verification-chain>
                <verify-gstin-api-service/>
                <verify-pan-api-service/>
                <verify-bank-penny-drop-service/>
            </api-verification-chain>
            <cross-check-data-service/>
            <manual-review-service/>
            <update-seller-status-service/>
            <notify-seller-verification-result-service/>
        </seller-chain>
    </flow>

    <flow id="video-kyc-flow">
        <seller-chain>
            <schedule-video-kyc-service/>
            <conduct-video-kyc-service/>
            <record-video-kyc-result-service/>
            <update-seller-status-service/>
        </seller-chain>
    </flow>

    <flow id="seller-approval-flow">
        <seller-chain>
            <admin-review-service/>
            <decision-gateway>
                <approve-seller-service/>
                <reject-seller-service/>
            </decision-gateway>
            <notify-seller-decision-service/>
            <conditional-chain condition="approved">
                <setup-seller-account-service/>
                <send-onboarding-guide-service/>
                <assign-account-manager-service/>
            </conditional-chain>

        </seller-chain>
    </flow>
    <flow id="resubmit-documents-flow">
        <seller-chain>
            <validate-resubmitted-documents-service/>
            <trigger-document-verification-flow/>
            <notify-seller-resubmission-received-service/>
        </seller-chain>
    </flow>
    <flow id="seller-update-flow">
        <seller-chain>
            <validate-seller-update-service/>
            <verification-chain>
                <verify-gstin-service/>
                <verify-pan-service/>
                <verify-bank-account-service/>
            </verification-chain>
            <update-seller-service/>
            <notify-seller-update-success-service/>
        </seller-chain>
    </flow>

</flows>
