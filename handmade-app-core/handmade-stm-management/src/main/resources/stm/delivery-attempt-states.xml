<?xml version="1.0" encoding="UTF-8"?>
<!--
DeliveryAttempt State Machine
Purpose: Manage the lifecycle of DeliveryAttempt entities
Flow: DELIVERY_ATTEMPT_FLOW
-->
<states>
    <event-information eventId='mark_delivered' 
                       eventName='Mark delivered' 
                       meta-acls="user.normal,user.admin"/>
    <event-information eventId='mark_failed' 
                       eventName='Mark failed' 
                       meta-acls="user.normal,user.admin"/>
    <event-information eventId='reschedule' 
                       eventName='Reschedule' 
                       meta-acls="user.normal,user.admin"/>

    <flow id="DELIVERY_ATTEMPT_FLOW" default="true">
        <manual-state id="ATTEMPTED" initialState="true">
            <on eventId="mark_delivered" newStateId="DELIVERED" componentName="deliverySuccessAction"/>
            <on eventId="mark_failed" newStateId="FAILED" componentName="deliveryFailAction"/>
        </manual-state>
        <manual-state id="FAILED">
            <on eventId="reschedule" newStateId="RESCHEDULED" componentName="deliveryRescheduleAction"/>
        </manual-state>
        <manual-state id="DELIVERED" meta-endState="true">

        </manual-state>
        <manual-state id="RESCHEDULED" meta-endState="true">

        </manual-state>

    </flow>
</states>
