@startuml Module Dependencies and Data Flow

!theme plain
skinparam linetype ortho
skinparam backgroundColor #FEFEFE

title Module Dependencies & Data Flow

' Define components
component "Product\nManagement" as PM #FFEBEE
component "Catalog\nManagement" as CM #E1F5FE
component "Promotion\nManagement" as PRM #FFF3E0
component "Analytics\nManagement" as AM #F3E5F5
component "Pricing\nEngine" as PE #E8F5E9
component "Order\nManagement" as OM #FFF9C4

' Data flow arrows
PM -down-> CM : "productId\n(reference only)"
CM -down-> PRM : "Category/Collection\nstructure"
CM -down-> AM : "Category/Product\nstructure"
AM -up-> CM : "Popularity scores\nTrend data"
PRM -right-> PE : "Discount rules"
CM -right-> PE : "Product categories"
PE -down-> OM : "Final prices"
OM -down-> AM : "Purchase events"

' Notes
note right of PM
  **Provides:**
  - Product data
  - Product IDs
  
  **Pattern:**
  - Other modules only store productId
  - Fetch details via ACL when needed
end note

note right of CM
  **Provides:**
  - Category hierarchy
  - Product categorization
  - Collections
  
  **Receives:**
  - Popularity updates from Analytics
  
  **Queries:**
  - getProductsByCategory()
  - getProductsByCollection()
  - getProductCategories()
end note

note right of PRM
  **Provides:**
  - Discount rules
  - Promotion targeting
  
  **Queries Catalog:**
  - Get products in category
  - Get products in collection
  
  **Example:**
  - Target: CATEGORY "Pottery"
  - Discount: 20%
end note

note right of AM
  **Tracks:**
  - Category views/purchases
  - Product views/purchases
  - Conversion rates
  
  **Calculates:**
  - Popularity scores
  - Trending products
  
  **Publishes:**
  - PopularCategoriesCalculatedEvent
end note

note bottom of PE
  **Responsibilities:**
  - Calculate base price
  - Apply promotions
  - Apply category discounts
  - Calculate final price
  
  **Integrates with:**
  - Catalog (get categories)
  - Promotion (get discounts)
end note

@enduml
