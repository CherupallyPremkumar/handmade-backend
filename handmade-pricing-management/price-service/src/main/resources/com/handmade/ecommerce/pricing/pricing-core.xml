<?xml version="1.0" encoding="UTF-8" ?>
<flows>
    <flow id="pricing-flow" defaultFlow="true">
        
        <!-- 
            Pricing Calculation Flow
            Follows the 6-step pricing calculation:
            1. Get Base Price (USD)
            2. Check Regional Override
            3. Convert Currency
            4. Apply Price Rules
            5. Calculate Tax
            6. Build Result
        -->
        <pricing-chain>
            
            <!-- Step 1: Get Base Price from database -->
            <get-base-price-command/>
            
            <!-- Step 2: Check for regional price override -->
            <check-regional-override-command/>
            
            <!-- Step 3: Convert to target currency if needed -->
            <convert-currency-command/>
            
            <!-- Step 4: Apply price rules (discounts, bulk, etc.) -->
            <apply-price-rules-command/>
            
            <!-- Step 5: Calculate tax based on region -->
            <calculate-price-tax-command/>
            
            <!-- Step 6: Build final result -->
            <build-price-result-command/>
            
        </pricing-chain>
        
    </flow>
    
    <!-- 
        Region-based routing (alternative flow)
        Use this for region-specific pricing flows
    -->
    <flow id="pricing-flow-by-region">
        <pricing-chain>
            <get-base-price-command/>
            
            <region-router expression="regionCode">
                
                <!-- India (IN) Flow -->
                <pricing-route-chain route="IN">
                    <check-regional-override-command/>
                    <apply-price-rules-command/>
                    <calculate-price-tax-command/> <!-- 18% GST -->
                    <build-price-result-command/>
                </pricing-route-chain>
                
                <!-- USA (US) Flow -->
                <pricing-route-chain route="US">
                    <check-regional-override-command/>
                    <apply-price-rules-command/>
                    <calculate-price-tax-command/> <!-- State-based tax -->
                    <build-price-result-command/>
                </pricing-route-chain>
                
                <!-- Default Flow -->
                <pricing-route-chain route="*">
                    <check-regional-override-command/>
                    <convert-currency-command/>
                    <apply-price-rules-command/>
                    <calculate-price-tax-command/>
                    <build-price-result-command/>
                </pricing-route-chain>
                
            </region-router>
        </pricing-chain>
    </flow>
    
</flows>
