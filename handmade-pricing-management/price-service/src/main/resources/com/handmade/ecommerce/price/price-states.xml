<?xml version="1.0" encoding="UTF-8"?>
<!--
Price State Machine
Purpose: Manages the lifecycle of price entities including sales and expiration
Lifecycle: CREATED → ACTIVE ⇄ ON_SALE → INACTIVE/EXPIRED

States:
- CREATED: Price created but not yet active
- ACTIVE: Price active and applicable to products
- ON_SALE: Price on sale with special discount
- INACTIVE: Price temporarily deactivated
- EXPIRED: Price expired and no longer valid (terminal state)

Events:
- activate: Activate a created or inactive price
- deactivate: Deactivate an active or on-sale price
- expire: Mark price as expired
- putOnSale: Put active price on sale
- removeFromSale: Remove price from sale back to active
-->
<states>
	<flow id="PRICE_FLOW" default="true">
		
		<!-- Lifecycle hooks -->
		<entry-action componentName="priceEntryAction"/>
		<exit-action componentName="priceExitAction"/>

		<!-- CREATED: Initial price creation -->
		<manual-state id="CREATED" initialState="true">
			<on eventId="activate" 
			    componentName="activatePriceInCreatedService" 
			    newStateId="ACTIVE"/>
		</manual-state>

		<!-- ACTIVE: Price is active and applicable -->
		<manual-state id="ACTIVE">
			<on eventId="deactivate" 
			    componentName="deactivatePriceService" 
			    newStateId="INACTIVE"/>
			<on eventId="expire" 
			    componentName="expirePriceService" 
			    newStateId="EXPIRED"/>
			<on eventId="putOnSale" 
			    componentName="putPriceOnSaleService" 
			    newStateId="ON_SALE"/>
		</manual-state>

		<!-- ON_SALE: Price on sale with discount -->
		<manual-state id="ON_SALE">
			<on eventId="removeFromSale" 
			    componentName="removePriceFromSaleService" 
			    newStateId="ACTIVE"/>
			<on eventId="deactivate" 
			    componentName="deactivatePriceFromSaleService" 
			    newStateId="INACTIVE"/>
		</manual-state>

		<!-- INACTIVE: Price temporarily deactivated -->
		<manual-state id="INACTIVE">
			<on eventId="activate" 
			    componentName="activatePriceInInActiveService" 
			    newStateId="ACTIVE"/>
		</manual-state>

		<!-- EXPIRED: Terminal state -->
		<manual-state id="EXPIRED" meta-endState="true"/>
		
	</flow>
</states>
