<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="001-create-platform-owner-table" author="platform-team">
        <comment>Create platform_owner table for managing platform configurations</comment>
        
        <createTable tableName="platform_owner" schemaName="public">
            <!-- Primary Key -->
            <column name="id" type="VARCHAR(255)">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            
            <!-- Core Platform Information -->
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="legal_business_name" type="VARCHAR(255)"/>
            <column name="tax_registration_id" type="VARCHAR(255)"/>
            <column name="registered_address" type="VARCHAR(255)"/>
            
            <!-- Contact Information -->
            <column name="support_email" type="VARCHAR(255)"/>
            <column name="support_phone_number" type="VARCHAR(255)"/>
            
            <!-- Localization -->
            <column name="primary_currency" type="VARCHAR(255)"/>
            <column name="supported_currencies" type="VARCHAR(255)"/>
            <column name="timezone" type="VARCHAR(255)"/>
            <column name="default_language" type="VARCHAR(255)"/>
            <column name="supported_languages" type="VARCHAR(255)"/>
            
            <!-- Branding -->
            <column name="primary_color_hex" type="VARCHAR(255)"/>
            <column name="logo_url" type="VARBINARY(255)"/>
            <column name="favicon_url" type="VARBINARY(255)"/>
            
            <!-- State Machine -->
            <column name="state_id" type="VARCHAR(255)"/>
            <column name="flow_id" type="VARCHAR(255)"/>
            <column name="state_entry_time" type="TIMESTAMP"/>
            
            <!-- SLA Tracking -->
            <column name="sla_red_date" type="TIMESTAMP"/>
            <column name="sla_yellow_date" type="TIMESTAMP"/>
            <column name="sla_late" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            <column name="sla_tending_late" type="INTEGER" defaultValue="0">
                <constraints nullable="false"/>
            </column>
            
            <!-- Status Flags -->
            <column name="suspended" type="BOOLEAN"/>
            <column name="suspension_reason" type="VARCHAR(255)"/>
            <column name="deleted" type="BOOLEAN"/>
            <column name="deleted_at" type="TIMESTAMP"/>
            <column name="deleted_by" type="VARCHAR(255)"/>
            
            <!-- Configuration References -->
            <column name="active_commission_policy_id" type="VARCHAR(255)"/>
            <column name="active_feature_config_id" type="VARCHAR(255)"/>
            
            <!-- Compliance Configuration -->
            <column name="requires_sellerkyc" type="BOOLEAN"/>
            <column name="requires_tax_id" type="BOOLEAN"/>
            <column name="allowed_jurisdictions" type="VARCHAR(255) ARRAY"/>
            
            <!-- Operational Limits -->
            <column name="max_sellers_per_day" type="INTEGER"/>
            <column name="max_transaction_amount" type="DECIMAL(38,2)"/>
            <column name="global_rate_limit" type="INTEGER"/>
            
            <!-- Multi-tenancy -->
            <column name="tenant" type="VARCHAR(255)"/>
            
            <!-- Audit Fields -->
            <column name="created_time" type="TIMESTAMP"/>
            <column name="created_by" type="VARCHAR(255)"/>
            <column name="last_modified_time" type="TIMESTAMP"/>
            <column name="last_modified_by" type="VARCHAR(255)"/>
            <column name="version" type="BIGINT" defaultValue="0">
                <constraints nullable="false"/>
            </column>
        </createTable>
        
        <!-- Indexes -->
        <createIndex indexName="idx_platform_owner_tenant" tableName="platform_owner">
            <column name="tenant"/>
        </createIndex>
        
        <createIndex indexName="idx_platform_owner_state" tableName="platform_owner">
            <column name="state_id"/>
        </createIndex>
        
        <createIndex indexName="idx_platform_owner_deleted" tableName="platform_owner">
            <column name="deleted"/>
        </createIndex>
        
        <rollback>
            <dropTable tableName="platform_owner" schemaName="public"/>
        </rollback>
    </changeSet>

</databaseChangeLog>
