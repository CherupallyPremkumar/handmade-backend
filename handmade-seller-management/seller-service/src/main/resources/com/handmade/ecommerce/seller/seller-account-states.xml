
<?xml version="1.0" encoding="UTF-8"?>
<!--
SellerAccount State Machine - Based on Amazon Seller Central Workflow
Multi-step verification: Identity → Tax → Bank → Product Approval
Performance monitoring: Active → At Risk → Suspended → Deactivated
-->
<states>
    <flow id='SELLER_ACCOUNT_FLOW' default="true">
        
        <!-- Initial state check - auto-detect based on verification status -->
        <if id='checkVerificationStatus' condition="hasStartedVerification" then="resumeVerification" else="startDraft" initialState="true">
            <on eventId="resumeVerification" newStateId="IDENTITY_VERIFICATION"/>
            <on eventId="startDraft" newStateId="DRAFT"/>
        </if>

        <!-- DRAFT: Initial registration started -->
        <manual-state id='DRAFT'>
            <on eventId="submitApplication" newStateId="IDENTITY_VERIFICATION"/>
            <on eventId="delete" newStateId='DELETED'/>
        </manual-state>

        <!-- IDENTITY_VERIFICATION: Upload ID, selfie, proof of address -->
        <manual-state id='IDENTITY_VERIFICATION'>
            <on eventId="verifyIdentity" newStateId="TAX_VERIFICATION"/>
            <on eventId="reject" newStateId="REJECTED"/>
            <on eventId="requestMoreInfo" newStateId="IDENTITY_INFO_REQUESTED"/>
        </manual-state>

        <!-- IDENTITY_INFO_REQUESTED: Additional identity documents needed -->
        <manual-state id='IDENTITY_INFO_REQUESTED'>
            <on eventId="submitAdditionalDocs" newStateId="IDENTITY_VERIFICATION"/>
            <on eventId="reject" newStateId="REJECTED"/>
        </manual-state>
å
        <!-- TAX_VERIFICATION: Complete W-9/W-8, tax interview -->
        <manual-state id='TAX_VERIFICATION'>
            <on eventId="completeTaxInterview" newStateId="BANK_VERIFICATION"/>
            <on eventId="reject" newStateId="REJECTED"/>
        </manual-state>

        <!-- BANK_VERIFICATION: Add bank account, verify micro-deposits -->
        <manual-state id='BANK_VERIFICATION'>
            <on eventId="verifyBankAccount" newStateId="PENDING_APPROVAL"/>
            <on eventId="reject" newStateId="REJECTED"/>
        </manual-state>

        <!-- PENDING_APPROVAL: All verifications complete, awaiting admin approval -->
        <manual-state id='PENDING_APPROVAL'>
            <on eventId="approve" newStateId="ACTIVE"/>
            <on eventId="reject" newStateId="REJECTED"/>
        </manual-state>

        <!-- ACTIVE: Seller can list products and receive orders -->
        <manual-state id="ACTIVE">
            <!-- Performance-based transitions -->
            <on eventId="flagPerformanceIssue" newStateId="AT_RISK"/>
            <on eventId="suspend" newStateId="SUSPENDED"/>
            
            <!-- Self-transitions for updates -->
            <on eventId="updateProfile"/>
            <on eventId="updateBankingInfo"/>
            <on eventId="updateBusinessDetails"/>
            <on eventId="updateTaxInfo"/>
            <on eventId="updateTier"/>
        </manual-state>

        <!-- AT_RISK: Performance issues detected (ODR > 1%, LSR > 4%, etc.) -->
        <manual-state id='AT_RISK'>
            <on eventId="resolveIssues" newStateId="ACTIVE"/>
            <on eventId="suspend" newStateId="SUSPENDED"/>
            
            <!-- Self-transitions -->
            <on eventId="sendWarning"/>
            <on eventId="updatePerformanceMetrics"/>
        </manual-state>

        <!-- SUSPENDED: Account temporarily suspended -->
        <manual-state id='SUSPENDED'>
            <on eventId="reactivate" newStateId="ACTIVE"/>
            <on eventId="deactivate" newStateId="DEACTIVATED"/>
            <on eventId="requestReinstatement" newStateId="PENDING_REINSTATEMENT"/>
        </manual-state>

        <!-- PENDING_REINSTATEMENT: Seller appealing suspension -->
        <manual-state id='PENDING_REINSTATEMENT'>
            <on eventId="approveReinstatement" newStateId="ACTIVE"/>
            <on eventId="rejectReinstatement" newStateId="DEACTIVATED"/>
        </manual-state>

        <!-- DEACTIVATED: Permanently closed (can reapply) -->
        <manual-state id='DEACTIVATED'>
            <on eventId="reapply" newStateId="DRAFT"/>
        </manual-state>

        <!-- REJECTED: Application rejected during verification -->
        <manual-state id='REJECTED'>
            <on eventId="reapply" newStateId="DRAFT"/>
        </manual-state>

        <!-- DELETED: Draft deleted before submission -->
        <manual-state id="DELETED"/>
    </flow>
</states>
