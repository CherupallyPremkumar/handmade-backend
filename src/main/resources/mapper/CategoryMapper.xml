<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.homebase.admin.mapper.CategoryMapper">

    <!-- Result Map for Category -->
    <resultMap id="categoryResultMap" type="com.homebase.admin.entity.Category">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="slug" column="slug"/>
        <result property="description" column="description"/>
        <result property="productCount" column="product_count"/>
        <result property="tenantId" column="tenant_id"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="deleted" column="deleted"/>
    </resultMap>

    <!-- Find all categories by tenant -->
    <select id="findAllByTenantId" resultMap="categoryResultMap">
        SELECT * FROM categories 
        WHERE tenant_id = #{tenantId} AND deleted = false 
        ORDER BY name ASC
    </select>

    <!-- Find category by ID -->
    <select id="findByIdAndTenantId" resultMap="categoryResultMap">
        SELECT * FROM categories 
        WHERE id = #{id} AND tenant_id = #{tenantId} AND deleted = false
    </select>

    <!-- Find category by slug -->
    <select id="findBySlugAndTenantId" resultMap="categoryResultMap">
        SELECT * FROM categories 
        WHERE slug = #{slug} AND tenant_id = #{tenantId} AND deleted = false
    </select>

    <!-- Count categories by tenant -->
    <select id="countByTenantId" resultType="long">
        SELECT COUNT(*) FROM categories 
        WHERE tenant_id = #{tenantId} AND deleted = false
    </select>

    <!-- Check if slug exists -->
    <select id="existsBySlugAndTenantId" resultType="boolean">
        SELECT EXISTS(
            SELECT 1 FROM categories 
            WHERE slug = #{slug} AND tenant_id = #{tenantId} AND deleted = false
        )
    </select>

</mapper>
