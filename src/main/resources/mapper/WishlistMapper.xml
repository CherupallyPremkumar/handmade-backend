<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.homebase.ecom.mapper.WishlistMapper">

    <resultMap id="wishlistResultMap" type="com.homebase.ecom.domain.Wishlist">
        <id property="id" column="id"/>
        <result property="customerId" column="customer_id"/>
        <result property="tenantId" column="tenant_id"/>
    </resultMap>

    <resultMap id="wishlistItemResultMap" type="com.homebase.ecom.domain.WishlistItem">
        <id property="id" column="id"/>
        <result property="wishlistId" column="wishlist_id"/>
        <result property="productId" column="product_id"/>
        <result property="tenantId" column="tenant_id"/>
    </resultMap>

    <select id="findByCustomerIdAndTenantId" resultMap="wishlistResultMap">
        SELECT * FROM wishlists WHERE customer_id = #{customerId} AND tenant_id = #{tenantId}
    </select>

    <select id="findWishlistItemsByWishlistId" resultMap="wishlistItemResultMap">
        SELECT wi.*, p.name as product_name, p.price as product_price, p.image_url as product_image, p.stock as product_stock
        FROM wishlist_items wi
        JOIN products p ON wi.product_id = p.id
        WHERE wi.wishlist_id = #{wishlistId} AND wi.tenant_id = #{tenantId}
    </select>

    <select id="findWishlistItemByWishlistAndProduct" resultMap="wishlistItemResultMap">
        SELECT * FROM wishlist_items 
        WHERE wishlist_id = #{wishlistId} AND product_id = #{productId} AND tenant_id = #{tenantId}
    </select>

    <select id="countWishlistItems" resultType="int">
        SELECT COUNT(*) FROM wishlist_items WHERE wishlist_id = #{wishlistId} AND tenant_id = #{tenantId}
    </select>

    <select id="existsInWishlist" resultType="boolean">
        SELECT EXISTS(SELECT 1 FROM wishlist_items WHERE wishlist_id = #{wishlistId} AND product_id = #{productId} AND tenant_id = #{tenantId})
    </select>

</mapper>
