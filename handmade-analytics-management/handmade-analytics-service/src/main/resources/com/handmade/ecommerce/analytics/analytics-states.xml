<?xml version="1.0" encoding="UTF-8"?>
<!--
Standard E-commerce Metric Definition State Machine
Purpose: Manage lifecycle of observability metrics and KPIs.
Flow: METRIC_DEFINITION_FLOW
Lifecycle: DRAFT -> ACTIVE -> PAUSED -> ARCHIVED
-->
<states>
    <event-information eventId="createMetric"      eventName="Create metric"      meta-acls="observability.admin"/>
    <event-information eventId="activateMetric"    eventName="Activate metric"    meta-acls="observability.admin"/>
    <event-information eventId="pauseMetric"       eventName="Pause metric"       meta-acls="observability.admin"/>
    <event-information eventId="resumeMetric"      eventName="Resume metric"      meta-acls="observability.admin"/>
    <event-information eventId="archiveMetric"     eventName="Archive metric"     meta-acls="observability.admin"/>
    <event-information eventId="updateThreshold"   eventName="Update threshold"   meta-acls="observability.manager"/>

    <flow id="METRIC_DEFINITION_FLOW" default="true">
        <manual-state id="DRAFT" initialState="true">
            <on eventId="activateMetric"   newStateId="ACTIVE"      componentName="com.handmade.ecommerce.analytics.service.cmds.ActivateMetricDefinitionAction"/>
            <on eventId="archiveMetric"    newStateId="ARCHIVED"    componentName="com.handmade.ecommerce.analytics.service.cmds.ArchiveMetricDefinitionAction"/>
        </manual-state>

        <manual-state id="ACTIVE">
            <on eventId="pauseMetric"      newStateId="PAUSED"      componentName="com.handmade.ecommerce.analytics.service.cmds.PauseMetricDefinitionAction"/>
            <on eventId="updateThreshold"  newStateId="ACTIVE"      componentName="com.handmade.ecommerce.analytics.service.cmds.UpdateThresholdMetricDefinitionAction"/>
            <on eventId="archiveMetric"    newStateId="ARCHIVED"    componentName="com.handmade.ecommerce.analytics.service.cmds.ArchiveMetricDefinitionAction"/>
        </manual-state>

        <manual-state id="PAUSED">
            <on eventId="resumeMetric"     newStateId="ACTIVE"      componentName="com.handmade.ecommerce.analytics.service.cmds.ResumeMetricDefinitionAction"/>
            <on eventId="archiveMetric"    newStateId="ARCHIVED"    componentName="com.handmade.ecommerce.analytics.service.cmds.ArchiveMetricDefinitionAction"/>
        </manual-state>

        <manual-state id="ARCHIVED" meta-endState="true"/>
    </flow>
</states>
