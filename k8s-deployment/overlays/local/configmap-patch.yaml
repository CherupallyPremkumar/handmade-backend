apiVersion: v1
kind: ConfigMap
metadata:
  name: handmade-config
data:
  # Database Configuration - Using H2
  db.host: "localhost"
  db.port: "0"
  db.name: "handmade_local"
  
  # Redis Configuration - Optional for local
  redis.host: "localhost"
  redis.port: "6379"
  
  # Logging Configuration
  logging.level.root: "INFO"
  logging.level.com.handmade: "DEBUG"
  logging.level.org.springframework.web: "DEBUG"
  logging.level.org.hibernate.SQL: "DEBUG"
  logging.level.org.hibernate.type.descriptor.sql.BasicBinder: "TRACE"
  
  # CORS Configuration - Allow all for local development
  cors.allowed.origins: "*"
  cors.allowed.methods: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
  cors.allowed.headers: "*"
  cors.allow.credentials: "true"
  
  # JWT Configuration - Relaxed for local
  jwt.expiration: "86400000"
  jwt.refresh.expiration: "604800000"
  
  # Feature Flags - Enable all features
  feature.payment.enabled: "true"
  feature.reviews.enabled: "true"
  feature.recommendations.enabled: "true"
  feature.debug.enabled: "true"
  feature.mock.payment: "true"
  
  # Application Properties
  application.yaml: |
    spring:
      application:
        name: handmade-backend-local
      
      # H2 Database Configuration
      datasource:
        url: jdbc:h2:mem:handmade_local
        driver-class-name: org.h2.Driver
        username: sa
        password: 
      
      h2:
        console:
          enabled: true
          path: /h2-console
          settings:
            web-allow-others: true
      
      jpa:
        hibernate:
          ddl-auto: create-drop
        show-sql: true
        properties:
          hibernate:
            dialect: org.hibernate.dialect.H2Dialect
            format_sql: true
            use_sql_comments: true
            generate_statistics: true
        defer-datasource-initialization: true
      
      sql:
        init:
          mode: always
          data-locations: classpath:data-local.sql
      
      jackson:
        serialization:
          write-dates-as-timestamps: false
          indent-output: true
        time-zone: UTC
      
      servlet:
        multipart:
          max-file-size: 10MB
          max-request-size: 10MB
      
      devtools:
        restart:
          enabled: true
        livereload:
          enabled: true
    
    server:
      port: 8080
      compression:
        enabled: true
      error:
        include-message: always
        include-binding-errors: always
        include-stacktrace: always
        include-exception: true
    
    management:
      server:
        port: 8081
      endpoints:
        web:
          exposure:
            include: "*"
      endpoint:
        health:
          show-details: always
      metrics:
        export:
          prometheus:
            enabled: true
    
    # Swagger/OpenAPI Configuration
    springdoc:
      swagger-ui:
        enabled: true
        path: /swagger-ui.html
        operations-sorter: method
        tags-sorter: alpha
      api-docs:
        enabled: true
        path: /api-docs
      show-actuator: true
    
    # Logging
    logging:
      level:
        root: INFO
        com.handmade: DEBUG
        org.springframework.web: DEBUG
        org.hibernate.SQL: DEBUG
        org.hibernate.type.descriptor.sql.BasicBinder: TRACE
      pattern:
        console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
        file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
