<?xml version="1.0" encoding="UTF-8"?>
<!--
Platform State Machine
Purpose: Manages the lifecycle of the platform owner entity
Lifecycle: BOOTSTRAPPING → ACTIVE → SUSPENDED/MAINTENANCE → DELETED

States:
- BOOTSTRAPPING: Initial platform setup and configuration
- ACTIVE: Platform is operational and accepting traffic
- SUSPENDED: Platform temporarily disabled (maintenance, issues)
- MAINTENANCE: Platform in read-only mode for updates
- DELETED: Platform permanently removed (terminal state)

Events:
- bootstrapping: Initialize platform from scratch
- checkCurrentState: Resume from existing state
- activate: Activate platform from bootstrapping
- suspend: Temporarily suspend platform operations
- reactivate: Restore platform from suspension
- enterMaintenance: Put platform in maintenance mode
- exitMaintenance: Exit maintenance mode back to active
- delete: Permanently delete platform
- updateBrandIdentity: Update brand information (self-transition)
- publishLegalTerms: Update legal terms (self-transition)
- updateFeatureConfig: Update feature flags (self-transition)
- updateOperationalLimits: Update operational limits (self-transition)
-->
<states>
	<flow id='PLATFORM_FLOW' default="true">
		
		<!-- Initial state check - auto-detect based on platform state -->
		<if id='isBootstrapping' 
		    condition="bootstrapping" 
		    then="bootstrapping" 
		    else="checkCurrentState" 
		    initialState="true">
			<on eventId="bootstrapping" newStateId="BOOTSTRAPPING"/>
			<on eventId="checkCurrentState" newStateId="ACTIVE"/>
		</if>

		<!-- BOOTSTRAPPING: Initial platform setup -->
		<manual-state id='BOOTSTRAPPING'>
			<on eventId="activate" newStateId="ACTIVE"/>
			<on eventId="delete" newStateId='DELETED'/>
		</manual-state>

		<!-- ACTIVE: Normal platform operations -->
		<manual-state id="ACTIVE">
			<!-- State transitions -->
			<on eventId="suspend" newStateId="SUSPENDED"/>
			<on eventId="enterMaintenance" newStateId="MAINTENANCE"/>
			<on eventId="delete" newStateId="DELETED"/>
			
			<!-- Self-transitions for configuration updates -->
			<on eventId="updateBrandIdentity"/>
			<on eventId="publishLegalTerms"/>
			<on eventId="updateFeatureConfig"/>
			<on eventId="updateOperationalLimits"/>
		</manual-state>

		<!-- SUSPENDED: Temporarily disabled -->
		<manual-state id='SUSPENDED'>
			<on eventId="reactivate" newStateId="ACTIVE"/>
			<on eventId="delete" newStateId="DELETED"/>
		</manual-state>

		<!-- MAINTENANCE: Read-only mode for updates -->
		<manual-state id="MAINTENANCE">
			<on eventId="exitMaintenance" newStateId="ACTIVE"/>
			<on eventId="suspend" newStateId="SUSPENDED"/>
		</manual-state>

		<!-- DELETED: Terminal state -->
		<manual-state id="DELETED" meta-endState="true"/>
	</flow>
</states>
