<?xml version="1.0" encoding="UTF-8" ?>
<flows>
    <flow id="cartline-flow" defaultFlow="true">
        
        <!-- Region-based routing for different pricing/tax/inventory systems -->
        <cart-line-chain>
            <set-cartline-region-command-service/>
         <region-router expression="region">
            
            <!-- India (INR) Flow -->
            <cart-line-route-chain route="INR">
                <!-- Parallel: Pricing + Inventory -->
                <fetch-price-command/>
                <check-inventory-command/>
                
                <!-- Sequential: Tax → Discounts → Total -->
                <cart-line-chain>
                    <calculate-tax-command/>
                    <apply-discounts-command/>
                    <calculate-line-total-command/>
                </cart-line-chain>
            </cart-line-route-chain>
            
            <!-- USA (USD) Flow -->
            <cart-line-route-chain route="USD">
                <!-- Parallel: Pricing + Inventory -->
                <fetch-price-command/>
                <check-inventory-command/>
                
                <!-- Sequential: Tax → Total (no discounts) -->
                <cart-line-cal-chain>
                    <calculate-tax-command/>
                    <calculate-line-total-command/>
                </cart-line-cal-chain>
            </cart-line-route-chain>
            
            <!-- Mexico (MXN) Flow -->
            <cart-line-route-chain route="MXN">
                <!-- Parallel: Pricing + Inventory -->
                <fetch-price-command/>
                <check-inventory-command/>
                
                <!-- Sequential: Tax → Discounts → Total -->
                <cart-line-chain>
                    <calculate-tax-command/>
                    <apply-discounts-command/>
                    <calculate-line-total-command/>
                </cart-line-chain>
            </cart-line-route-chain>
        </region-router>
        </cart-line-chain>
        
    </flow>
</flows>