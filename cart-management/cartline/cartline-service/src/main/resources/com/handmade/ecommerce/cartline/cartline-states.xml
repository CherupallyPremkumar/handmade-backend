<?xml version="1.0" encoding="UTF-8"?>
<!-- An example states xml file that demonstrates the following features:
 1. The progression of Cartline from OPENED to CLOSED 
 2. How to define and use a custom DSL to define the workflow.
     This also demonstrates how to attach security permissions (not roles) to a state event so that
     these perms would be checked before the action is allowed.
-->
<states>

	<event-information eventId='increment_qty' eventName='Increment Quantity' 
                   meta-acls="user.normal,user.premium"
                   meta-bodyType='com.handmade.ecommerce.command.cart.CartLineIncrementQtyPayLoad'/>
<event-information eventId='decrement_qty' eventName='Decrement Quantity' 
                   meta-acls="user.normal,user.premium"
                   meta-bodyType='com.handmade.ecommerce.command.cart.CartLineDecrementQtyPayLoad'/>

	<default-transition-action componentName="cartlineBaseTransitionAction"/>
    <add-state-tag tag="status" manualState="true"/>
    <add-transition-tag tag="on-action" eventIdTag="id" newStateIdTag="move-to"
                    meta-acls="test.premium"/>

	<flow id='CartlineFlow' default='true'>
		<entry-action componentName="cartlineEntryAction"/>
		<exit-action componentName="cartlineExitAction"/>
        <security-strategy componentName="stmSecurityStrategy"/>
		<status id='CREATED' initialState='true'>
		 <on-action id='increment_qty' componentName='incrementQtyCommandService' newStateId='CREATED'/>
		 <on-action id='decrement_qty' componentName='decrementQtyCommandService' newStateId='CREATED'/>
			<on-action id='delete' componentName='deleteCartLineCommandService' newStateId='DELETED'/>
			<on-action id='update' componentName='updateCartLineCommandService' newStateId='CREATED'/>
			<on-action id='close' componentName='closeCartLineCommandService' newStateId='VOID'/>
		</status>

		<status id='DELETED'>
		</status>

        <status id='VOID'>
			<on-action id='close' move-to='VOID'/>
        </status>
        <status id='CLOSED' />


	</flow>
	
</states>
