<?xml version="1.0" encoding="UTF-8"?>
<!--
Role State Machine
Purpose: Manage lifecycle of IAM roles from draft to deactivated.
Flow: ROLE_FLOW
Lifecycle: DRAFT -> ACTIVE -> SUSPENDED -> DEACTIVATED
-->
<states>
    <!-- Role Management Events -->
    <event-information eventId="createRole"       eventName="Create role"       meta-acls="iam.admin"/>
    <event-information eventId="activateRole"     eventName="Activate role"     meta-acls="iam.admin"/>
    <event-information eventId="suspendRole"      eventName="Suspend role"      meta-acls="iam.admin"/>
    <event-information eventId="reactivateRole"   eventName="Reactivate role"   meta-acls="iam.admin"/>
    <event-information eventId="deactivateRole"   eventName="Deactivate role"   meta-acls="iam.admin"/>

    <!--
    Flow: ROLE_FLOW
    Lifecycle: DRAFT -> ACTIVE -> SUSPENDED -> DEACTIVATED
    -->
    <flow id="ROLE_FLOW" default="true">
        <manual-state id="DRAFT" initialState="true">
            <on eventId="activateRole"   newStateId="ACTIVE"      componentName="roleActivateAction"/>
            <on eventId="deactivateRole" newStateId="DEACTIVATED" componentName="roleDeactivateAction"/>
        </manual-state>

        <manual-state id="ACTIVE">
            <on eventId="suspendRole"    newStateId="SUSPENDED"   componentName="roleSuspendAction"/>
            <on eventId="deactivateRole" newStateId="DEACTIVATED" componentName="roleDeactivateAction"/>
        </manual-state>

        <manual-state id="SUSPENDED">
            <on eventId="reactivateRole" newStateId="ACTIVE"      componentName="roleReactivateAction"/>
            <on eventId="deactivateRole" newStateId="DEACTIVATED" componentName="roleDeactivateAction"/>
        </manual-state>

        <manual-state id="DEACTIVATED" meta-endState="true"/>
    </flow>
</states>
