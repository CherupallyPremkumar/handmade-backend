<?xml version="1.0" encoding="UTF-8"?>
<!-- An example states xml file that demonstrates the following features:
 1. The progression of Payment from OPENED to CLOSED  and ARCHIVED.
 2. How to define and use a custom DSL to define the workflow.
 3. How to use the activity framework to define mandatory and optional activities (along with a custom
 DSL that allows us to define these activities)
 4. How to define an automatic "activity-checker" state that allows us to check if all the mandatory
 activities are completed before we proceed to the next status in the workflow.
     This also demonstrates how to attach security permissions (not roles) to a state event so that
     these perms would be checked before the action is allowed.
-->
<states>
    <enablement-strategy componentName="paymentConfigBasedEnablementStrategy"/>
	<default-transition-action componentName="paymentBaseTransitionAction"/>
    <add-transition-tag tag="mandatory-activity" meta-activity="MANDATORY"
                        meta-acls="test.premium" eventIdTag="id"/>
    <add-transition-tag tag="optional-activity" meta-activity="OPTIONAL"
                        meta-acls="test.premium" eventIdTag="id"/>
    <add-transition-tag tag="mandatory-post-closure-activity" meta-activity="MANDATORY"
                        meta-acls="test.premium" eventIdTag="id"
                        newStateId="AreClosedActivitiesComplete"/>
    <add-state-tag tag="post-closure-activities-completion-check"
                   componentName="activitiesCompletionCheck"
                   id="AreClosedActivitiesComplete"
                   whichStateId="CLOSED" />
    <add-transition-tag tag="on-completion" newStateIdTag="goto" eventId="yes"/>
    <add-transition-tag tag="if-not-complete" newStateIdTag="stay-in" eventId="no"/>
    <add-state-tag tag="status" manualState="true"/>
    <add-transition-tag tag="on-action" eventIdTag="id" newStateIdTag="move-to"
                    meta-acls="test.premium"/>

	<flow id='PaymentFlow' default='true'>
		<entry-action componentName="paymentEntryAction"/>
		<exit-action componentName="paymentExitAction"/>
        <security-strategy componentName="stmSecurityStrategy"/>
		<status id='OPENED' initialState='true'>
			<on-action id='assign'  move-to='ASSIGNED'/>
		</status>

		<status id='ASSIGNED'>
			<on-action id='resolve' move-to='RESOLVED' />
		</status>

        <status id='RESOLVED'>
            <mandatory-activity id='doRetrospective'/>
            <mandatory-activity id='doPerfTesting'/>
            <on-action id='close' move-to='CLOSED'/>
        </status>
        <status id='CLOSED' >
            <mandatory-post-closure-activity id='captureObservations'/>
        </status>
        <post-closure-activities-completion-check>
            <on-completion goto="ARCHIVED"/>
            <if-not-complete stay-in="CLOSED"/>
        </post-closure-activities-completion-check>
        <status id='ARCHIVED' />


	</flow>
	
</states>
